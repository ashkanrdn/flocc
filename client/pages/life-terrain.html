<div id="container"></div>
<div id="histogram-vx"></div>
<div id="histogram-vy"></div>
<script>
    const {
        Agent,
        Environment,
        GridEnvironment,
        Histogram,
        ASCIIRenderer,
        CanvasRenderer,
        utils,
        Vector,
        KDTree,
        Terrain
    } = flocc;
    const { random } = utils;

    /* ------- PARAMETERS --------- */
    const width = 700;
    const height = 700;

    /* ---------------------------- */

    /* ------- SET UP ENVIRONMENT, RENDERER --------- */

    const environment = new Environment({
        height,
        width
    });
    const renderer = new CanvasRenderer(environment, { width, height });
    const container = document.getElementById("container");
    renderer.mount(container);

    const terrain = new Terrain(width, height, { grayscale: true });
    environment.use(terrain);
    console.log(terrain);

    function isAlive(x, y) {
        return terrain.sample(x, y) === 255;
    }

    const dead = 0;
    const alive = 255;

    function setup() {
        for (let y = 0; y < height; y++) {
            for (let x = 0; x < width; x++) {
                terrain.set(x, y, Math.abs(Math.sin(x * y)) < 0.1 ? 255 : 0);
            }
        }

        const x = 100;
        const y = 100;
        terrain.set(x, y, alive);
        terrain.set(x + 1, y + 1, alive);
        terrain.set(x - 1, y + 2, alive);
        terrain.set(x, y + 2, alive);
        terrain.set(x + 1, y + 2, alive);

        terrain.rule = (x, y) => {
            let livingNeighbors = 0;
            for (var dx = -1; dx <= 1; dx++) {
                for (var dy = -1; dy <= 1; dy++) {
                    if (dx === 0 && dy === 0) continue;
                    if (isAlive(x + dx, y + dy)) livingNeighbors++;
                }
            }

            if (isAlive(x, y) && livingNeighbors < 2) return dead;
            if (isAlive(x, y) && livingNeighbors > 3) return dead;
            if (!isAlive(x, y) && livingNeighbors === 3) return alive;
        };
    }

    function render() {
        environment.tick();
        requestAnimationFrame(render);
    }

    setup();
    render();
</script>
