<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Client-side Tests</title>
        <script src="/flocc.js"></script>
        <script>
            for (let key in flocc) {
                window[key] = flocc[key];
            }
        </script>
    </head>
    <body>
        <div id="canvas"></div>
        <div id="line"></div>
        <script>
            (function() {
                const environment = new Environment();
                const renderer = new CanvasRenderer(environment, {
                    background: "#eef",
                    width: 300,
                    height: 300,
                    scale: 2,
                    origin: {
                        x: 300,
                        y: 200
                    }
                });
                renderer.mount("#canvas");

                const chart = new LineChartRenderer(environment, {
                    background: "#eee",
                    range: { min: 180, max: 350 }
                });
                chart.mount("#line");
                chart.metric("x", { color: "red", fn: utils.min });
                chart.metric("x", { fn: utils.max });
                chart.metric("x", { color: "blue", fn: utils.mean });
                chart.metric("x", { color: "green", fn: utils.median });
                chart.metric("x", {
                    color: "orange",
                    fn: arr => arr.filter(v => v >= 35).length
                });

                function meander(agent) {
                    agent.increment("x", Math.random() > 0.5 ? 1 : -1);
                    agent.increment("y", Math.random() > 0.5 ? 1 : -1);
                }

                function setup() {
                    for (let i = 0; i < 12; i++) {
                        const agent = new Agent();
                        agent.set("x", utils.random(300, 305));
                        agent.set("y", utils.random(200, 230));
                        agent.set("size", 2);
                        agent.set("shape", "arrow");
                        agent.set("vx", 1);
                        agent.set("vy", 1);
                        agent.addRule(meander);
                        environment.addAgent(agent);
                    }
                }

                function draw() {
                    environment.tick();
                    window.requestAnimationFrame(draw);
                }

                setup();
                draw();
            })();
        </script>
    </body>
</html>
